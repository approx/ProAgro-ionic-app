<!--
  Generated template for the ActivityRegisterPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-content padding>
  <h1>Registrar nova Atividade</h1>
  <form (ngSubmit)="Register()" #RegisterForm="ngForm">
    <ion-grid padding class="formContent">
      <ion-row style="align-items: flex-end;">
        <ion-col col-12 col-md-6 col-lg-6>
          <ion-item padding-top>
            <ion-label>Atividade*</ion-label>
            <ion-select [(ngModel)]="activity_type" (ngModelChange)="selectActivity($event)" required name="activityType">
              <ion-option *ngFor="let activityType of activityTypes" [value]="activityType">{{activityType.id}} - {{activityType.name}}</ion-option>
            </ion-select>
          </ion-item>
        </ion-col>
        <ion-col col-12 col-md-6 col-lg-6>
          <ion-item>
            <ion-label floating>Valor Unitario*</ion-label>
            <ion-input type="text" readonly="true" value="{{unity_value}}"></ion-input>
          </ion-item>
        </ion-col>
        <ion-col col-12 col-md-3>
          <ion-item>
            <ion-label floating>Dose*</ion-label>
            <ion-input type="text" required maxlength="45" #name="ngModel" (change)="Calculate()" [(ngModel)]="activity.dose" name="dose" value=""></ion-input>
          </ion-item>
        </ion-col>
        <ion-col col-12 col-md-3>
          <ion-item padding-top>
            <ion-label>Unidade*</ion-label>
            <ion-select [(ngModel)]="activity.unity_id" required name="unity">
              <ion-option *ngFor="let unity of unities" value="{{unity.id}}">{{unity.id}}</ion-option>
            </ion-select>
          </ion-item>
        </ion-col>
        <ion-col col-12 col-md-4 col-lg-3>
          <ion-item>
            <ion-label>Data da operação</ion-label>
            <ion-datetime displayFormat="DD/MM/YYYY" required max="{{maxDate}}" pickerFormat="DD MM YYYY" name="operation_date" [(ngModel)]="activity.operation_date"></ion-datetime>
          </ion-item>
        </ion-col>
        <ion-col col-12 col-md-4 col-lg-3>
          <ion-item>
            <ion-label>Data do pagamento</ion-label>
            <ion-datetime displayFormat="DD/MM/YYYY" required max="{{maxDate}}" pickerFormat="DD MM YYYY" name="payment_date" [(ngModel)]="activity.payment_date"></ion-datetime>
          </ion-item>
        </ion-col>
      </ion-row>
      <ion-row margin-top margin-bottom *ngIf="activity_type && activity.dose && activity.unity_id" style="align-items: flex-end;">
        {{field}} {{crop}}
        <ion-col col-12>
          <ion-row>
            <ion-col col-5>
              <ion-item>
                <ion-label>Exibir safras finalizadas</ion-label>
                <ion-checkbox color="primary" name="finished_crops" (ionChange)="cleanFilters()" [(ngModel)]="finished_crops"></ion-checkbox>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-col>
        <ion-col col-12 [attr.col-md-4]="finished_crops? '' : null" [attr.col-md-6]="!finished_crops? '' : null">
          <ion-item padding-top>
            <ion-label>Fazenda</ion-label>
            <ion-select [(ngModel)]="farm" (ngModelChange)="filterFarm($event)" name="farm">
              <ion-option *ngFor="let farm of farms" [value]="farm">{{farm.name}}</ion-option>
            </ion-select>
          </ion-item>
        </ion-col>
        <ion-col col-12 [attr.col-md-4]="finished_crops? '' : null" [attr.col-md-6]="!finished_crops? '' : null">
          <ion-item padding-top>
            <ion-label>Talhão</ion-label>
            <ion-select [(ngModel)]="field" (ngModelChange)="filterFields($event)" name="field">
              <ion-option *ngFor="let field of filteredFields" [value]="field">{{field.name}}</ion-option>
            </ion-select>
          </ion-item>
        </ion-col>
        <ion-col col-12 [attr.col-md-4]="finished_crops? '' : null" [ngClass]="{'hide':!finished_crops}">
          <ion-item padding-top>
            <ion-label>Safra</ion-label>
            <ion-select [(ngModel)]="crop" (ngModelChange)="safraSelected($event)" name="crop">
              <ion-option *ngFor="let crop of filteredCrops" [value]="crop">{{crop.name}}</ion-option>
            </ion-select>
          </ion-item>
        </ion-col>
        <ion-col col-12 class="crpoItens" padding>
          <ion-row *ngFor="let iten of cropsRegister">
            <ion-col style="text-align:center">
              {{iten.crop.field.farm.name}}
            </ion-col>
            <ion-col style="text-align:center">
              {{iten.crop.field.name}}
            </ion-col>
            <ion-col style="text-align:center">
              {{iten.crop.name}}
            </ion-col>
            <ion-col style="text-align:center">
              Dose: {{iten.dose}}&nbsp;{{activity.unity_id}}/ha
            </ion-col>
            <ion-col style="text-align:center">
              Quantidade: {{iten.quantity}}&nbsp;{{activity.unity_id}}
            </ion-col>
            <ion-col style="text-align:center">
              Valor por ha: R$ {{iten.value_per_ha}}
            </ion-col>
            <ion-col style="text-align:center">
              Valor Total: R$ {{iten.total}}
            </ion-col>
            <ion-item>
              <ion-range min="0" max="100" name="range" (ionChange)="changedIten(iten)" [(ngModel)]="iten.percentage" color="primary">
                <ion-label range-left>Dose</ion-label>
                <ion-label range-right>{{iten.percentage}}% <ion-icon (click)="remove(iten)" style="font-size:2em;margin-left:10px;" name="remove-circle"></ion-icon></ion-label>
              </ion-range>
            </ion-item>
          </ion-row>
        </ion-col>
      </ion-row>
      <ion-row margin-top class="justifyCenter" margin-bottom>
        <button type="submit" [disabled]="!RegisterForm.form.valid || !cropsRegister.length>0" ion-button col-12 col-md-3>Cadastrar</button>
      </ion-row>
    </ion-grid>
  </form>
</ion-content>
